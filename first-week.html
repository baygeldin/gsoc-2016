<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <title>First week | GSoC 2016</title>
    <meta name="description" content="Web GDB frontend project with Mozilla." />

    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!--<link rel="shortcut icon" href="favicon.ico">-->
    <meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="msapplication-TileColor" content="#9a1aaf">
		<meta name="msapplication-TileImage" content="http://baygeldin.name/gsoc-2016/assets/favicon/mstile-144x144.png">
		<meta name="msapplication-config" content="http://baygeldin.name/gsoc-2016/assets/favicon/browserconfig.xml" />

		<link rel="manifest" href="http://baygeldin.name/gsoc-2016/assets/favicon/manifest.json">
		<link rel="apple-touch-icon-precomposed" sizes="57x57" href="http://baygeldin.name/gsoc-2016/assets/favicon/apple-touch-icon-57x57.png" />
		<link rel="apple-touch-icon-precomposed" sizes="60x60" href="http://baygeldin.name/gsoc-2016/assets/favicon/apple-touch-icon-60x60.png" />
		<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://baygeldin.name/gsoc-2016/assets/favicon/apple-touch-icon-72x72.png" />
		<link rel="apple-touch-icon-precomposed" sizes="76x76" href="http://baygeldin.name/gsoc-2016/assets/favicon/apple-touch-icon-76x76.png" />
		<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://baygeldin.name/gsoc-2016/assets/favicon/apple-touch-icon-114x114.png" />
		<link rel="apple-touch-icon-precomposed" sizes="120x120" href="http://baygeldin.name/gsoc-2016/assets/favicon/apple-touch-icon-120x120.png" />
		<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://baygeldin.name/gsoc-2016/assets/favicon/apple-touch-icon-144x144.png" />
		<link rel="apple-touch-icon-precomposed" sizes="152x152" href="http://baygeldin.name/gsoc-2016/assets/favicon/apple-touch-icon-152x152.png" />
		<link rel="mask-icon" href="http://baygeldin.name/gsoc-2016/assets/favicon/safari-pinned-tab.svg" color="#9a1aaf">
		<link rel="icon" type="image/png" href="http://baygeldin.name/gsoc-2016/assets/favicon/favicon-16x16.png" sizes="16x16" />
		<link rel="icon" type="image/png" href="http://baygeldin.name/gsoc-2016/assets/favicon/favicon-32x32.png" sizes="32x32" />
		<link rel="icon" type="image/png" href="http://baygeldin.name/gsoc-2016/assets/favicon/favicon-96x96.png" sizes="96x96" />

    <link rel="stylesheet" type="text/css" href="http://baygeldin.name/gsoc-2016/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Noto+Serif:400,700,400italic|Open+Sans:700,400" />
    <link rel="stylesheet" type="text/css" href="http://baygeldin.name/gsoc-2016/assets/css/prism.css" />

    <!-- Ghost outputs important style and meta data with this tag -->
    <!-- {{ghost_head}} -->
</head>
<body class="post-template">

    
        <main class="content" role="main">

    <article class="post">
      <header class="post-header">
    <a class="blog-logo" href="http://baygeldin.name/gsoc-2016">
        
            <img src="http://baygeldin.name/gsoc-2016/assets/images/gsoc.png" alt="Blog Logo" />
        
    </a>
</header>


        <span class="post-meta"><time datetime="Sun, 29 May 2016 21:00:00 GMT">30 May 2016</time></span>

        <section class="post-content">
            <h1>First week</h1><p>So, the first week of GSoC has passed and here&#39;s my first weekly report. During this week the main goal was to get some <code>gdb-js</code> tests running. So, I&#39;ve implemented some tests first and then started to raise functionality to match these tests. But as usual things have been changing along the way. </p>
<h2>On tests</h2><p>The first idea was to write tests this way: </p>
<ol>
<li>Mock the stdin/stdout/stderr streams</li>
<li>Pass them to the newly created GDB wrapper instance</li>
<li>Check the state consistency and the stdin output</li>
</ol>
<p>For streams mocking I decided to create a command line util to run GDB and write the results of its execution to a json file (with streams splitting, of course). The problem here was that output of some programs when they are not attached to interactive device is line-buffered and debugging these programs becomes hard. The workaround I&#39;ve come up with:</p>
<pre><code class="language-javascript">let gdb = spawn(&#39;stdbuf&#39;, [&#39;-i0&#39;, &#39;-o0&#39;, &#39;-e0&#39;,
  &#39;gdb&#39;, &#39;--interpreter=mi&#39;, &#39;./main&#39;])
</code></pre>
<p>So far so good and it feels like it&#39;s a right approach to do unit tests. But there is one significant disadvantage to it: the tests are not clear. It&#39;s hard to reason about what the specific test should do by looking at the json file with recorded streams. So, I decided to take another approach â€” use the actual GDB instance. So the tests now are looking more like integration tests than unit tests. But it&#39;s fine... The only thing I don&#39;t like is that they&#39;re much slower for obvious reasons :) The integration tests are done this way:</p>
<ul>
<li>I&#39;ve set up a <a href="https://github.com/baygeldin/gdb-examples">GitHub repo</a> with Docker image and an <a href="https://hub.docker.com/r/baygeldin/gdb-examples/">automation build for it</a> on DockerHub.</li>
<li>I use <code>dockerode-promise</code> wrapper to run the Docker container with this image from Node.js</li>
<li>And then execute tests within the container</li>
</ul>
<p>The next challenge was to write the code that would match these tests. First, I created some abstract implementation of the GDB wrapper class. I choosed to use <code>highland.js</code> for stream handling since it has zero dependencies and awesome documentation. Then I started to think about parser.</p>
<h2>On parsers</h2><p>GDB/MI output syntax plays well with JSON in fact. So the natural approach was to map it to JSON. I&#39;ve considered several parser generators and decided to use <code>PEG.js</code> since it&#39;s very easy to use and it has a nice <a href="http://pegjs.org/online">online version</a>. There was one problem with symbols escaping in the grammar but I&#39;ve handled it by taking an example of JSON parser for PEG.js:</p>
<pre><code class="language-javascript">Const &quot;c-string&quot;
  = &quot;\&quot;&quot; chars:Char* &quot;\&quot;&quot; { return chars.join(&#39;&#39;) }

Char &quot;char&quot;
  = [\x20-\x21\x23-\x5B\x5D-\u10FFFF]
  / &quot;\\&quot; seq:Escaped { return seq }

Escaped &quot;escaped&quot;
  = (&quot;\&quot;&quot; / &quot;\\&quot;) / (&quot;b&quot; / &quot;f&quot; / &quot;n&quot; / &quot;r&quot; / &quot;t&quot;) {
      return &#39;\\&#39; + text()
    }
</code></pre>
<p>By the way, seems like the official GDB/MI syntax has some mistakes according to their bugzilla but I hope it won&#39;t be a big problem.</p>
<h2>Results</h2><ul>
<li>Parser for GDB/MI is working</li>
<li>Test for state checking is passing</li>
</ul>
<h2>P.S.</h2><ul>
<li>During my parser generators investigation I&#39;ve understood that my knowledge of syntax analysers is poor... So I planned to spend some time on them later on. On the other hand, I found an awesome and almost fresh article about <a href="http://www.antlr.org/papers/allstar-techreport.pdf">state-of-art analyzer</a>!</li>
<li>The next week I want to write even more tests and more methods for a GDB wrapper. I need to do it in pace in order to save some time for preparation to the exam which will be held on 9th of June.</li>
</ul>
        </section>

        <footer class="post-footer">

            
                <section class="author">
                    <h4>Alexander Baygeldin</h4>
                    <p>Hi, here are my weekly reports for GSoC 2016</p>
                </section>
            

            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="http://twitter.com/share?text=30 May 2016&url=http://baygeldin.name/gsoc-2016/first-week"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://baygeldin.name/gsoc-2016/first-week"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=http://baygeldin.name/gsoc-2016/first-week"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>

        </footer>

    </article>

</main>

    

    <footer class="site-footer">
    <a class="subscribe icon-feed" href="http://baygeldin.name/gsoc-2016/rss/index.xml"><span class="tooltip">Subscribe!</span></a>
    <div class="inner">
         <section class="copyright">All rights violated  &copy; 2016</section>
    </div>
</footer>

    <!-- Ghost outputs important scripts and data with this tag -->
    <!-- {{ghost_foot}} -->

    <script src="https://code.jquery.com/jquery-1.12.3.min.js" integrity="sha256-aaODHAgvwQW1bFOGXMeX+pC4PZIPsvn2h1sArYOhgXQ=" crossorigin="anonymous"></script>    
    <script type="text/javascript" src="http://baygeldin.name/gsoc-2016/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="http://baygeldin.name/gsoc-2016/assets/js/index.js"></script>
    <script type="text/javascript" src="http://baygeldin.name/gsoc-2016/assets/js/prism.js"></script>

</body>
</html>
